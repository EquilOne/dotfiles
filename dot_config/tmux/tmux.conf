# =============================================================================
# TMUX CONFIGURATION - Rose Pine Moon + Neovim Optimized
# =============================================================================

# =============================================================================
# 1. CORE SETTINGS & NEovIM OPTIMIZATIONS
# =============================================================================

# Neovim Critical: Zero escape time eliminates lag when pressing Esc
set -s escape-time 0

# Neovim Critical: Enable focus events for file change detection
set -g focus-events on

# Terminal: Force 256-color support with RGB override for themes
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Performance: Increase scrollback history for better context
set -g history-limit 50000

# UX: Make messages readable (4 seconds vs default ~750ms)
set -g display-time 4000

# Indexing: Start windows/panes at 1 to match keyboard layout
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on

# =============================================================================
# 2. KEYBINDINGS - Vi-Mode Workflow
# =============================================================================

# Prefix: Change from Ctrl+b to Ctrl+s (more ergonomic)
unbind C-b
set -g prefix C-s
bind C-s send-prefix

# Configuration: Quick reload with feedback
unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded!"

# Pane Management: Split while maintaining current directory
bind | split-window -h -c "#{pane_current_path}"  # Horizontal split
bind - split-window -v -c "#{pane_current_path}"  # Vertical split

# Navigation: Vi-style pane movement
set -g mouse on
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Window Navigation: Essential window switching
bind C-p previous-window
bind C-n next-window
bind Tab last-window   # Toggle between current and previous window

# =============================================================================
# 3. KILL OPERATIONS - Tiered Safety Levels
# =============================================================================

# Pane Management: No confirmation (frequent, low-risk operation)
bind x kill-pane

# Window/Session Management: Smart conditional logic
# Multiple windows: kill window immediately
# Single window: prompt before killing entire session
bind X if-shell '[ #{window_count} -gt 1 ]' 'kill-window' 'confirm-before -p "kill-session #S? (y/n)" "kill-session"'

# Server Management: Always confirm (most destructive operation)
bind C-x confirm-before -p "kill-server? (y/n)" "kill-server"

# =============================================================================
# 4. PLUGIN DECLARATIONS
# =============================================================================
set -g @plugin 'tmux-plugins/tpm'                    # Plugin Manager
set -g @plugin 'rose-pine/tmux'                      # Rose Pine Moon Theme
set -g @plugin 'MunifTanjim/tmux-mode-indicator'    # Visual Mode Indicators
set -g @plugin 'tmux-plugins/tmux-yank'              # System Clipboard Integration
set -g @plugin 'christoomey/vim-tmux-navigator'      # Seamless Vim/Tmux Navigation

# =============================================================================
# 5. THEME CONFIGURATION - Rose Pine Moon
# =============================================================================

# Base Theme Settings
set -g status-position top
set -g @rose_pine_variant 'moon'
set -g @rose_pine_bar_bg_disable 'on'
set -g @rose_pine_bar_bg_disabled_color_option 'default'

# Status Bar Content: Mode indicator on the left
set -g @rose_pine_status_left_prepend_section '#{tmux_mode_indicator} '

# Mode Indicator Colors: Using Rose Pine Moon palette
set -g @mode_indicator_prefix_mode_style 'bg=default,fg=#eb6f92'  # Love (red)
set -g @mode_indicator_copy_mode_style 'bg=default,fg=#f6c177'    # Gold (yellow)
set -g @mode_indicator_sync_mode_style 'bg=default,fg=#c4a7e7'     # Iris (purple)
set -g @mode_indicator_empty_mode_style 'bg=default,fg=#908caa'    # Subtle (gray)

# Smart Window Naming: Built-in tmux automatic rename
# Format: command:directory (e.g., nvim:config, bash:projects)
set -g @rose_pine_default_window_behavior 'off'
setw -g automatic-rename on
setw -g automatic-rename-format '#{pane_current_command}:#{b:pane_current_path}'

# Performance: Instant status updates with event-driven refresh
set -g status-interval 1
set-hook -g after-select-window 'refresh-client -S'
set-hook -g after-select-pane 'refresh-client -S'
set-hook -g window-layout-changed 'refresh-client -S'

# =============================================================================
# 6. STATUS BAR MODULES & ICONS
# =============================================================================

# Right Side Content: Hostname display
set -g @rose_pine_host 'on'
set -g @rose_pine_hostname_short 'on'
set -g @rose_pine_directory 'off'

# Window List Styling: Clean separation and interaction
set -g @rose_pine_window_status_separator " ⏽ "     # Separator between windows
set -g @rose_pine_disable_active_window_menu 'on'   # Disable popup menu

# Visual Separators: Minimal spacing for clean look
set -g @rose_pine_field_separator ' '

# Custom Icons: Nerd Font icons for visual enhancement
set -g @rose_pine_session_icon ''           # Session icon
set -g @rose_pine_current_window_icon ''    # Active window icon
set -g @rose_pine_folder_icon ''            # Directory icon
set -g @rose_pine_username_icon ''          # Username icon
set -g @rose_pine_hostname_icon '󰒋'          # Hostname icon
set -g @rose_pine_date_time_icon '󰃰'        # Date/time icon
set -g @rose_pine_status_left_append_section '   '  # Left section append

# =============================================================================
# 7. INITIALIZE TPM (Plugin Manager)
# =============================================================================
run '~/.config/tmux/plugins/tpm/tpm'
